#!/bin/sh
set -e

# enter project root dir
cd `dirname $0`
cd ../

# convert .md to .html files
echo 'converting markdown files to html...'
rm -f ./*.html
rm -rf ./install
mkdir -p ./install

for file in ./src/*.md
do
    PREFIX=$(basename "$file" | cut -d. -f1)
    pandoc $file -T $PREFIX -V "pagetitle:$PREFIX" -V "title:$PREFIX" -w html5 -o "$PREFIX.html" --template ./templates/layout.html
done

for file in ./src/install/*.md
do
    PREFIX=$(basename "$file" | cut -d. -f1)
    pandoc $file -T $PREFIX -V "pagetitle:$PREFIX" -V "title:$PREFIX" -w html5 -o ./install/"$PREFIX.html" --template ./templates/layout.html
done
echo 'finished'

# build API documentation
echo 'building api documentation...'
cd ./src/api-docs
bundle install
bundle exec middleman build --clean --build-dir=../../api-docs
